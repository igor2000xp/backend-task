version: "3.8"

services:
 sql-server:
  image: mcr.microsoft.com/mssql/server:2022-latest
  environment:
   - ACCEPT_EULA=Y
   - SA_PASSWORD=YourStrong!Password123
   - MSSQL_PID=Developer
  ports:
   - "1433:1433"
  volumes:
   - sqlserver_data:/var/opt/mssql
  healthcheck:
   test: /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P YourStrong!Password123 -C -Q "SELECT 1" || exit 1
   interval: 10s
   retries: 10
   start_period: 10s
   timeout: 3s

 api:
  build:
   context: .
   dockerfile: Dockerfile
  environment:
   - ASPNETCORE_ENVIRONMENT=Production
   - DB_PASSWORD=YourStrong!Password123
  ports:
   - "5000:8080"
  depends_on:
   sql-server:
    condition: service_healthy

volumes:
 sqlserver_data:
